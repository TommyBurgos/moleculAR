<!-- plantilla_pregunta_adaptada.html - PARTE 1: ENCABEZADO Y RECURSOS MULTIMEDIA -->
<div class="plantilla-pregunta" data-tipo="{{ pregunta.tipo.nombre }}" data-pregunta-id="{{ pregunta.id }}">
    
    <!-- Encabezado com칰n de la pregunta -->
    <div class="row mb-3">
        <div class="col-md-8">
            <label class="form-label fw-bold">
                <i class="fas fa-question-circle me-2 text-primary"></i>
                Enunciado de la pregunta
            </label>
            <textarea class="form-control" rows="3" 
                      placeholder="Escribe el enunciado de tu pregunta aqu칤..."
                      data-field="enunciado"
                      data-pregunta-id="{{ pregunta.id }}">{{ pregunta.enunciado|default:"" }}</textarea>
            <small class="text-muted">
                <i class="fas fa-lightbulb me-1"></i>
                Escribe una pregunta clara y espec칤fica que los estudiantes puedan entender f치cilmente.
            </small>
        </div>
        <div class="col-md-4">
            <div class="row">
                <div class="col-6">
                    <label class="form-label fw-bold">
                        <i class="fas fa-star me-2 text-warning"></i>
                        Puntaje
                    </label>
                    <div class="input-group">
                        <input type="number" class="form-control" value="{{ pregunta.puntaje|default:1 }}" 
                               min="1" step="1" data-field="puntaje" data-pregunta-id="{{ pregunta.id }}">
                        <span class="input-group-text">pts</span>
                    </div>
                    <small class="text-muted">Puntos que vale esta pregunta</small>
                </div>
                <div class="col-6">
                    <label class="form-label fw-bold">
                        <i class="fas fa-user-check me-2 text-info"></i>
                        Calificaci칩n
                    </label>
                    <div class="calificacion-manual">
                        <input type="checkbox" id="calificacion-manual-{{ pregunta.id }}" 
                               data-field="calificacion_manual"
                               data-pregunta-id="{{ pregunta.id }}"
                               {% if pregunta.calificacion_manual %}checked{% endif %}>
                        <label for="calificacion-manual-{{ pregunta.id }}" class="small">
                            Manual
                        </label>
                    </div>
                    <small class="text-muted d-block">Marcar si requiere revisi칩n manual</small>
                </div>
            </div>
        </div>
    </div>

    <!-- SECCI칍N DE RECURSOS MULTIMEDIA (MEJORADA Y PROFESIONAL) -->
    <div class="recursos-multimedia-section">
        <!-- Toggle button con dise침o profesional -->
        <button type="button" class="recursos-apoyo-toggle" 
                data-bs-toggle="collapse" 
                data-bs-target="#recursos-{{ pregunta.id }}" 
                aria-expanded="false"
                onclick="toggleRecursosApoyo(this)">
            <i class="fas fa-paperclip me-2"></i>
            <span>Recursos de apoyo (opcional)</span>
            <i class="fas fa-chevron-down ms-auto toggle-icon"></i>
        </button>
        
        <!-- Contenido de recursos (colapsable) -->
        <div class="collapse" id="recursos-{{ pregunta.id }}">
            <div class="recursos-content">
                <div class="recursos-header">
                    <h6 class="mb-3">
                        <i class="fas fa-layer-group me-2 text-primary"></i>
                        Tipo de recurso multimedia
                    </h6>
                </div>
                
                <!-- Tipos de recursos con dise침o profesional -->
                <div class="row g-3 mb-4">
                    <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                        <div class="recurso-card" data-tipo="imagen" onclick="abrirModalRecurso('imagen', {{ pregunta.id }})">
                            <div class="recurso-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <div class="recurso-title">Imagen</div>
                            <div class="recurso-subtitle">JPG, PNG, GIF</div>
                        </div>
                    </div>
                    
                    <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                        <div class="recurso-card" data-tipo="video" onclick="abrirModalRecurso('video', {{ pregunta.id }})">
                            <div class="recurso-icon">
                                <i class="fas fa-video"></i>
                            </div>
                            <div class="recurso-title">Video</div>
                            <div class="recurso-subtitle">MP4, WebM</div>
                        </div>
                    </div>
                    
                    <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                        <div class="recurso-card" data-tipo="youtube" onclick="abrirModalRecurso('youtube', {{ pregunta.id }})">
                            <div class="recurso-icon">
                                <i class="fab fa-youtube"></i>
                            </div>
                            <div class="recurso-title">YouTube</div>
                            <div class="recurso-subtitle">URL de video</div>
                        </div>
                    </div>
                    
                    <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                        <div class="recurso-card" data-tipo="documento" onclick="abrirModalRecurso('documento', {{ pregunta.id }})">
                            <div class="recurso-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="recurso-title">Documento</div>
                            <div class="recurso-subtitle">PDF, DOC, PPT</div>
                        </div>
                    </div>
                    
                    <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                        <div class="recurso-card" data-tipo="simulador" onclick="abrirModalRecurso('simulador', {{ pregunta.id }})">
                            <div class="recurso-icon">
                                <i class="fas fa-atom"></i>
                            </div>
                            <div class="recurso-title">Simulador</div>
                            <div class="recurso-subtitle">Molecular</div>
                        </div>
                    </div>
                    
                    <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                        <div class="recurso-card" data-tipo="audio" onclick="abrirModalRecurso('audio', {{ pregunta.id }})">
                            <div class="recurso-icon">
                                <i class="fas fa-volume-up"></i>
                            </div>
                            <div class="recurso-title">Audio</div>
                            <div class="recurso-subtitle">MP3, WAV</div>
                        </div>
                    </div>
                </div>
                
                <!-- Consejos para recursos efectivos -->
                <div class="recursos-tips">
                    <div class="alert alert-info border-0">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Consejos para recursos efectivos:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Las im치genes deben ser claras y relevantes al contenido</li>
                            <li>Los videos de YouTube deben estar relacionados con la pregunta</li>
                            <li>Los documentos PDF deben ser legibles y no muy extensos</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Recursos actualmente cargados -->
                <div class="recursos-actuales" id="recursos-actuales-{{ pregunta.id }}">
                    {% if pregunta.archivo_multimedia or pregunta.url_youtube %}
                    <h6 class="mb-3">
                        <i class="fas fa-check-circle me-2 text-success"></i>
                        Recursos cargados
                    </h6>
                    <div class="recursos-lista">
                        {% if pregunta.archivo_multimedia %}
                        <div class="recurso-item">
                            <div class="recurso-info">
                                <i class="fas fa-file me-2"></i>
                                <span>{{ pregunta.archivo_multimedia.name|default:"Archivo multimedia" }}</span>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                    onclick="eliminarRecurso('archivo', {{ pregunta.id }})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        {% endif %}
                        
                        {% if pregunta.url_youtube %}
                        <div class="recurso-item">
                            <div class="recurso-info">
                                <i class="fab fa-youtube me-2 text-danger"></i>
                                <span>Video de YouTube: {{ pregunta.url_youtube }}</span>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                    onclick="eliminarRecurso('youtube', {{ pregunta.id }})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                
                <!-- Limitaciones -->
                <div class="recursos-limitaciones">
                    <small class="text-muted">
                        <i class="fas fa-exclamation-triangle me-1"></i>
                        L칤mites: 10MB im치genes, 50MB videos, 25MB documentos
                    </small>
                </div>
            </div>
        </div>
    </div>
    <!-- CONTENIDO ESPEC칈FICO POR TIPO DE PREGUNTA (INCLUDES) -->
    <div class="tipo-pregunta-content">
        {% if pregunta.tipo.nombre == 'opcion_unica' or pregunta.tipo.nombre == 'opcion_multiple' or pregunta.tipo.nombre == 'falso_verdadero' %}
            <!-- Incluir plantilla de opciones -->
            {% include 'docente/plantillas/plantilla_opciones.html' %}
            
        {% elif pregunta.tipo.nombre == 'respuesta_abierta' %}
            <!-- Incluir plantilla de respuesta abierta -->
            {% include 'docente/plantillas/plantilla_respuesta_abierta.html' %}
            
        {% elif pregunta.tipo.nombre == 'simulador_2d' or pregunta.tipo.nombre == 'simulador_3d' %}
            <!-- Incluir plantilla de simuladores -->
            {% include 'docente/plantillas/plantilla_simuladores.html' %}
            
        {% elif pregunta.tipo.nombre == 'unir_lineas' %}
            <!-- Incluir plantilla de unir l칤neas -->
            {% include 'docente/plantillas/plantilla_unir_lineas.html' %}
            
        {% elif pregunta.tipo.nombre == 'completar' %}
            <!-- Incluir plantilla de completar -->
            {% include 'docente/plantillas/plantilla_completar.html' %}
            
        {% else %}
            <!-- Tipo de pregunta no reconocido -->
            <div class="tipo-desconocido-container">
                <div class="alert alert-warning border-0">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Tipo de pregunta "{{ pregunta.tipo.nombre }}" no est치 configurado a칰n.</strong>
                    <br><small>Contacta al administrador para agregar soporte para este tipo.</small>
                </div>
            </div>
        {% endif %}
    </div>
    
    <!-- Acciones de la pregunta (com칰n para todos los tipos) -->
    <div class="pregunta-actions">
        <button type="button" class="btn btn-success btn-sm action-btn" 
                data-pregunta-id="{{ pregunta.id }}"
                onclick="guardarPregunta(this)"
                title="Guardar todos los cambios realizados">
            <i class="fas fa-save me-1"></i>Guardar cambios
        </button>
        
        <button type="button" class="btn btn-warning btn-sm action-btn" 
                data-pregunta-id="{{ pregunta.id }}"
                onclick="iniciarCambioTipo({{ pregunta.id }})"
                title="Cambiar el tipo de esta pregunta">
            <i class="fas fa-exchange-alt me-1"></i>Cambiar tipo
        </button>
        
        <button type="button" class="btn btn-info btn-sm action-btn" 
                data-pregunta-id="{{ pregunta.id }}"
                onclick="duplicarPregunta({{ pregunta.id }})"
                title="Crear una copia de esta pregunta">
            <i class="fas fa-copy me-1"></i>Duplicar
        </button>
        
        <button type="button" class="btn btn-danger btn-sm action-btn" 
                data-pregunta-id="{{ pregunta.id }}"
                onclick="eliminarPreguntaExistente(this)"
                title="Eliminar esta pregunta permanentemente">
            <i class="fas fa-trash me-1"></i>Eliminar
        </button>
        
        <!-- Informaci칩n adicional -->
        <div class="ms-auto d-flex align-items-center">
            <span class="pregunta-info">
                <i class="fas fa-info-circle me-1"></i>
                <strong>{{ pregunta.tipo.descripcion|title }}</strong> | 
                Orden: {{ pregunta.orden }} | 
                Puntos: {{ pregunta.puntaje }}
                {% if pregunta.fecha_creacion %}
                | {{ pregunta.fecha_creacion|date:"d/m/Y" }}
                {% endif %}
            </span>
        </div>
    </div>
</div>

<!-- ESTILOS PROFESIONALES Y ELEGANTES -->
<style>
/* ===== ESTILOS BASE PARA LA PLANTILLA ===== */
.plantilla-pregunta {
    border: 1px solid #e8ecef;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 20px;
    background: #ffffff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    transition: all 0.3s ease;
    position: relative;
}

.plantilla-pregunta:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    border-color: #0066cc;
}

.plantilla-pregunta::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: linear-gradient(to bottom, #0066cc, #004499);
    border-radius: 12px 0 0 12px;
}

/* ===== CAMPOS DE FORMULARIO MEJORADOS ===== */
.form-label {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    display: flex;
    align-items: center;
}

.form-control {
    font-size: 1rem;
    padding: 12px 16px;
    border: 1px solid #dde2e6;
    border-radius: 8px;
    background-color: #ffffff;
    transition: all 0.2s ease;
}

.form-control:focus {
    border-color: #0066cc;
    box-shadow: 0 0 0 0.2rem rgba(0, 102, 204, 0.1);
    background-color: #ffffff;
}

.form-control:hover {
    border-color: #b8c5d1;
}

/* ===== SECCI칍N DE RECURSOS MULTIMEDIA ===== */
.recursos-multimedia-section {
    margin: 20px 0;
    border-top: 1px solid #f0f3f6;
    padding-top: 20px;
}

.recursos-apoyo-toggle {
    width: 100%;
    padding: 12px 20px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 1px solid #dee2e6;
    border-radius: 8px;
    color: #495057;
    font-weight: 500;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    cursor: pointer;
}

.recursos-apoyo-toggle:hover {
    background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
    color: #212529;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.recursos-apoyo-toggle.active {
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    border-color: #0066cc;
    color: #0066cc;
}

.toggle-icon {
    transition: transform 0.3s ease;
}

.recursos-apoyo-toggle[aria-expanded="true"] .toggle-icon {
    transform: rotate(180deg);
}

.recursos-content {
    background: #ffffff;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    margin-top: 12px;
}

.recursos-header h6 {
    color: #2c3e50;
    font-weight: 600;
}

/* ===== TARJETAS DE RECURSOS ===== */
.recurso-card {
    background: #ffffff;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    padding: 16px 12px;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    height: 120px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
    overflow: hidden;
}

.recurso-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    width: 0;
    height: 3px;
    background: linear-gradient(90deg, #0066cc, #004499);
    transition: all 0.3s ease;
    transform: translateX(-50%);
}

.recurso-card:hover {
    border-color: #0066cc;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 102, 204, 0.15);
}

.recurso-card:hover::before {
    width: 100%;
}

.recurso-icon {
    font-size: 24px;
    color: #6c757d;
    margin-bottom: 8px;
    transition: color 0.3s ease;
}

.recurso-card:hover .recurso-icon {
    color: #0066cc;
}

.recurso-title {
    font-weight: 600;
    color: #2c3e50;
    font-size: 0.9rem;
    margin-bottom: 4px;
}

.recurso-subtitle {
    font-size: 0.75rem;
    color: #6c757d;
    line-height: 1.2;
}

/* ===== TIPS Y ALERTAS ===== */
.recursos-tips .alert {
    background: linear-gradient(135deg, #e8f4fd 0%, #f0f8ff 100%);
    border-left: 4px solid #0066cc;
    color: #2c3e50;
}

.recursos-tips ul {
    padding-left: 20px;
    font-size: 0.9rem;
}

.recursos-tips li {
    margin-bottom: 4px;
}

/* ===== RECURSOS ACTUALES ===== */
.recursos-actuales h6 {
    color: #28a745;
    font-weight: 600;
}

.recurso-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 15px;
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    margin-bottom: 8px;
}

.recurso-info {
    display: flex;
    align-items: center;
    color: #495057;
    font-weight: 500;
}

/* ===== CALIFICACI칍N MANUAL ===== */
.calificacion-manual {
    background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%);
    border: 1px solid #f39c12;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 8px;
    min-height: 40px;
}

.calificacion-manual input[type="checkbox"] {
    margin: 0;
    transform: scale(1.2);
    accent-color: #f39c12;
}

.calificacion-manual label {
    margin: 0;
    font-weight: 600;
    cursor: pointer;
    color: #856404;
}

/* ===== ACCIONES DE PREGUNTA ===== */
.pregunta-actions {
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid #f0f3f6;
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}

.action-btn {
    font-weight: 500;
    border-radius: 6px;
    transition: all 0.2s ease;
    border: none;
    font-size: 0.9rem;
    padding: 8px 16px;
}

.action-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}

.pregunta-info {
    background: #f8f9fa;
    padding: 8px 12px;
    border-radius: 6px;
    border: 1px solid #e9ecef;
    font-size: 0.8rem;
    color: #6c757d;
}

/* ===== LIMITACIONES ===== */
.recursos-limitaciones {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #f0f3f6;
    text-align: center;
}

/* ===== TIPO DESCONOCIDO ===== */
.tipo-desconocido-container .alert {
    border-left: 4px solid #dc3545;
    background: linear-gradient(135deg, #fdf2f2 0%, #fce4ec 100%);
    color: #721c24;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
    .plantilla-pregunta {
        padding: 16px;
        margin-bottom: 16px;
    }
    
    .pregunta-actions {
        flex-direction: column;
        align-items: stretch;
    }
    
    .action-btn {
        margin-bottom: 8px;
        width: 100%;
    }
    
    .pregunta-actions .ms-auto {
        margin-left: 0 !important;
        margin-top: 12px;
    }
    
    .calificacion-manual {
        min-height: 36px;
        padding: 6px 10px;
    }
    
    .recurso-card {
        height: 100px;
        padding: 12px 8px;
    }
    
    .recurso-icon {
        font-size: 20px;
        margin-bottom: 6px;
    }
    
    .recurso-title {
        font-size: 0.8rem;
    }
    
    .recurso-subtitle {
        font-size: 0.7rem;
    }
}

@media (max-width: 576px) {
    .recursos-content {
        padding: 15px;
    }
    
    .recursos-apoyo-toggle {
        padding: 10px 15px;
        font-size: 0.9rem;
    }
}
</style>

<!-- MODALES PARA CARGAR RECURSOS -->

<!-- Modal para Imagen -->
<div class="modal fade" id="modalRecursoImagen" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-image me-2"></i>
                    Cargar Imagen
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">Seleccionar archivo</label>
                        <input type="file" class="form-control" id="archivo-imagen" accept="image/*">
                        <small class="text-muted">Formatos: JPG, PNG, GIF (m치x. 10MB)</small>
                        
                        <div class="mt-3">
                            <label class="form-label">Descripci칩n (opcional)</label>
                            <input type="text" class="form-control" id="descripcion-imagen" 
                                   placeholder="Describe brevemente la imagen">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="preview-container">
                            <div id="preview-imagen" class="preview-area">
                                <i class="fas fa-image fa-3x text-muted"></i>
                                <p class="text-muted mt-2">Vista previa aparecer치 aqu칤</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="subirRecurso('imagen')">
                    <i class="fas fa-upload me-1"></i>Cargar Imagen
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Video -->
<div class="modal fade" id="modalRecursoVideo" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">
                    <i class="fas fa-video me-2"></i>
                    Cargar Video
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <label class="form-label fw-bold">Seleccionar archivo de video</label>
                <input type="file" class="form-control" id="archivo-video" accept="video/*">
                <small class="text-muted">Formatos: MP4, WebM, AVI (m치x. 50MB)</small>
                
                <div class="mt-3">
                    <label class="form-label">Descripci칩n (opcional)</label>
                    <input type="text" class="form-control" id="descripcion-video" 
                           placeholder="Describe brevemente el video">
                </div>
                
                <div class="mt-3">
                    <div id="preview-video" class="preview-area">
                        <i class="fas fa-video fa-3x text-muted"></i>
                        <p class="text-muted mt-2">Vista previa del video aparecer치 aqu칤</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-success" onclick="subirRecurso('video')">
                    <i class="fas fa-upload me-1"></i>Cargar Video
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para YouTube -->
<div class="modal fade" id="modalRecursoYoutube" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="fab fa-youtube me-2"></i>
                    Video de YouTube
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">URL del video de YouTube</label>
                        <input type="url" class="form-control" id="url-youtube" 
                               placeholder="https://www.youtube.com/watch?v=..."
                               onchange="previsualizarYoutube()">
                        <small class="text-muted">Pega la URL completa del video de YouTube</small>
                        
                        <div class="mt-3">
                            <label class="form-label">Descripci칩n (opcional)</label>
                            <input type="text" class="form-control" id="descripcion-youtube" 
                                   placeholder="Describe brevemente el video">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="preview-container">
                            <div id="preview-youtube" class="preview-area">
                                <i class="fab fa-youtube fa-3x text-muted"></i>
                                <p class="text-muted mt-2">Vista previa del video aparecer치 aqu칤</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger" onclick="subirRecurso('youtube')">
                    <i class="fab fa-youtube me-1"></i>Agregar Video
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Documento -->
<div class="modal fade" id="modalRecursoDocumento" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title">
                    <i class="fas fa-file-alt me-2"></i>
                    Cargar Documento
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <label class="form-label fw-bold">Seleccionar documento</label>
                <input type="file" class="form-control" id="archivo-documento" 
                       accept=".pdf,.doc,.docx,.ppt,.pptx,.txt">
                <small class="text-muted">Formatos: PDF, DOC, DOCX, PPT, PPTX, TXT (m치x. 25MB)</small>
                
                <div class="mt-3">
                    <label class="form-label">T칤tulo del documento</label>
                    <input type="text" class="form-control" id="titulo-documento" 
                           placeholder="Nombre descriptivo del documento">
                </div>
                
                <div class="mt-3">
                    <label class="form-label">Descripci칩n (opcional)</label>
                    <textarea class="form-control" rows="3" id="descripcion-documento" 
                              placeholder="Describe el contenido del documento"></textarea>
                </div>
                
                <div class="mt-3">
                    <div id="preview-documento" class="preview-area">
                        <i class="fas fa-file-alt fa-3x text-muted"></i>
                        <p class="text-muted mt-2">Informaci칩n del documento aparecer치 aqu칤</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-warning" onclick="subirRecurso('documento')">
                    <i class="fas fa-upload me-1"></i>Cargar Documento
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Simulador -->
<div class="modal fade" id="modalRecursoSimulador" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title">
                    <i class="fas fa-atom me-2"></i>
                    Simulador Molecular
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Configurar Mol칠cula</h6>
                        
                        <div class="mb-3">
                            <label class="form-label">Nombre de la mol칠cula</label>
                            <input type="text" class="form-control" id="nombre-molecula" 
                                   placeholder="Ej: Etanol, Benceno, Cafe칤na">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">SMILES (opcional)</label>
                            <input type="text" class="form-control" id="smiles-molecula" 
                                   placeholder="Ej: CCO para etanol">
                            <small class="text-muted">Si conoces el c칩digo SMILES, ingr칠salo aqu칤</small>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Descripci칩n</label>
                            <textarea class="form-control" rows="3" id="descripcion-simulador" 
                                      placeholder="Describe qu칠 deben hacer los estudiantes con esta mol칠cula"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Tipo de simulador</label>
                            <select class="form-select" id="tipo-simulador">
                                <option value="2d">Simulador 2D (estructuras planas)</option>
                                <option value="3d">Simulador 3D (modelo tridimensional)</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h6>Vista Previa</h6>
                        <div id="preview-simulador" class="preview-area" style="height: 300px;">
                            <i class="fas fa-atom fa-3x text-muted"></i>
                            <p class="text-muted mt-2">Simulador aparecer치 aqu칤</p>
                        </div>
                        
                        <div class="mt-3">
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="previsualizarSimulador()">
                                <i class="fas fa-eye me-1"></i>Vista Previa
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-info" onclick="buscarMoleculaPubChem()">
                                <i class="fas fa-search me-1"></i>Buscar en PubChem
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-info" onclick="subirRecurso('simulador')">
                    <i class="fas fa-atom me-1"></i>Agregar Simulador
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal para Audio -->
<div class="modal fade" id="modalRecursoAudio" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header text-white" style="background: #6f42c1;">
                <h5 class="modal-title">
                    <i class="fas fa-volume-up me-2"></i>
                    Cargar Audio
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <label class="form-label fw-bold">Seleccionar archivo de audio</label>
                <input type="file" class="form-control" id="archivo-audio" accept="audio/*">
                <small class="text-muted">Formatos: MP3, WAV, OGG (m치x. 10MB)</small>
                
                <div class="mt-3">
                    <label class="form-label">Descripci칩n (opcional)</label>
                    <input type="text" class="form-control" id="descripcion-audio" 
                           placeholder="Describe brevemente el audio">
                </div>
                
                <div class="mt-3">
                    <div id="preview-audio" class="preview-area">
                        <i class="fas fa-volume-up fa-3x text-muted"></i>
                        <p class="text-muted mt-2">Reproductor de audio aparecer치 aqu칤</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn" onclick="subirRecurso('audio')" 
                        style="background: #6f42c1; border-color: #6f42c1; color: white;">
                    <i class="fas fa-upload me-1"></i>Cargar Audio
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ESTILOS PARA LOS MODALES -->
<style>
.preview-area {
    border: 2px dashed #dee2e6;
    border-radius: 8px;
    padding: 40px 20px;
    text-align: center;
    background: #f8f9fa;
    min-height: 200px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.preview-area.has-content {
    border-style: solid;
    border-color: #28a745;
    background: #f8fff9;
}

.preview-container {
    height: 100%;
}

.modal-content {
    border: none;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    border-radius: 12px;
}

.modal-header {
    border-radius: 12px 12px 0 0;
    padding: 20px 24px;
}

.modal-body {
    padding: 24px;
}

.modal-footer {
    padding: 16px 24px;
    border-top: 1px solid #e9ecef;
}

/* Vista previa espec칤fica para cada tipo */
.preview-imagen img {
    max-width: 100%;
    max-height: 150px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.preview-video video {
    max-width: 100%;
    max-height: 150px;
    border-radius: 8px;
}

.preview-youtube iframe {
    width: 100%;
    height: 150px;
    border-radius: 8px;
}

.preview-audio audio {
    width: 100%;
    margin-top: 20px;
}

.preview-documento .doc-info {
    background: #ffffff;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 16px;
    text-align: left;
}

.preview-simulador .simulador-preview {
    width: 100%;
    height: 100%;
    border-radius: 8px;
    overflow: hidden;
}
</style>

<!-- JAVASCRIPT PARA FUNCIONALIDAD DE RECURSOS -->
<script>
// Variables globales para recursos
let preguntaActual = null;
let tipoRecursoActual = null;

// ===== FUNCIONES PRINCIPALES =====

function toggleRecursosApoyo(element) {
    const icon = element.querySelector('.toggle-icon');
    const isExpanded = element.getAttribute('aria-expanded') === 'true';
    
    if (isExpanded) {
        element.classList.add('active');
    } else {
        element.classList.remove('active');
    }
    
    console.log(`游늹 Recursos de apoyo ${isExpanded ? 'expandidos' : 'colapsados'}`);
}

function abrirModalRecurso(tipo, preguntaId) {
    preguntaActual = preguntaId;
    tipoRecursoActual = tipo;
    
    console.log(`游늭 Abriendo modal para ${tipo} en pregunta ${preguntaId}`);
    
    // Limpiar formularios previos
    limpiarModalRecurso(tipo);
    
    // Abrir modal correspondiente
    const modalId = `modalRecurso${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`;
    const modal = new bootstrap.Modal(document.getElementById(modalId));
    modal.show();
}

function limpiarModalRecurso(tipo) {
    // Limpiar campos seg칰n el tipo
    switch (tipo) {
        case 'imagen':
            document.getElementById('archivo-imagen').value = '';
            document.getElementById('descripcion-imagen').value = '';
            resetPreview('preview-imagen');
            break;
        case 'video':
            document.getElementById('archivo-video').value = '';
            document.getElementById('descripcion-video').value = '';
            resetPreview('preview-video');
            break;
        case 'youtube':
            document.getElementById('url-youtube').value = '';
            document.getElementById('descripcion-youtube').value = '';
            resetPreview('preview-youtube');
            break;
        case 'documento':
            document.getElementById('archivo-documento').value = '';
            document.getElementById('titulo-documento').value = '';
            document.getElementById('descripcion-documento').value = '';
            resetPreview('preview-documento');
            break;
        case 'simulador':
            document.getElementById('nombre-molecula').value = '';
            document.getElementById('smiles-molecula').value = '';
            document.getElementById('descripcion-simulador').value = '';
            document.getElementById('tipo-simulador').value = '2d';
            resetPreview('preview-simulador');
            break;
        case 'audio':
            document.getElementById('archivo-audio').value = '';
            document.getElementById('descripcion-audio').value = '';
            resetPreview('preview-audio');
            break;
    }
}

function resetPreview(previewId) {
    const preview = document.getElementById(previewId);
    if (preview) {
        preview.className = 'preview-area';
        
        // Contenido por defecto seg칰n el tipo
        const iconMap = {
            'preview-imagen': 'fas fa-image',
            'preview-video': 'fas fa-video',
            'preview-youtube': 'fab fa-youtube',
            'preview-documento': 'fas fa-file-alt',
            'preview-simulador': 'fas fa-atom',
            'preview-audio': 'fas fa-volume-up'
        };
        
        const textMap = {
            'preview-imagen': 'Vista previa aparecer치 aqu칤',
            'preview-video': 'Vista previa del video aparecer치 aqu칤',
            'preview-youtube': 'Vista previa del video aparecer치 aqu칤',
            'preview-documento': 'Informaci칩n del documento aparecer치 aqu칤',
            'preview-simulador': 'Simulador aparecer치 aqu칤',
            'preview-audio': 'Reproductor de audio aparecer치 aqu칤'
        };
        
        preview.innerHTML = `
            <i class="${iconMap[previewId]} fa-3x text-muted"></i>
            <p class="text-muted mt-2">${textMap[previewId]}</p>
        `;
    }
}

// ===== FUNCIONES DE VISTA PREVIA =====

function previsualizarYoutube() {
    const url = document.getElementById('url-youtube').value;
    const preview = document.getElementById('preview-youtube');
    
    if (!url) {
        resetPreview('preview-youtube');
        return;
    }
    
    // Extraer ID del video de YouTube
    const videoId = extraerYouTubeId(url);
    
    if (videoId) {
        preview.className = 'preview-area has-content';
        preview.innerHTML = `
            <iframe src="https://www.youtube.com/embed/${videoId}" 
                    frameborder="0" 
                    allowfullscreen>
            </iframe>
        `;
        console.log(`游꿘 Vista previa de YouTube cargada: ${videoId}`);
    } else {
        preview.innerHTML = `
            <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
            <p class="text-warning mt-2">URL de YouTube no v치lida</p>
        `;
    }
}

function extraerYouTubeId(url) {
    const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
    const match = url.match(regex);
    return match ? match[1] : null;
}

function previsualizarSimulador() {
    const nombre = document.getElementById('nombre-molecula').value;
    const smiles = document.getElementById('smiles-molecula').value;
    const tipo = document.getElementById('tipo-simulador').value;
    const preview = document.getElementById('preview-simulador');
    
    if (!nombre && !smiles) {
        resetPreview('preview-simulador');
        return;
    }
    
    preview.className = 'preview-area has-content';
    preview.innerHTML = `
        <div class="simulador-preview">
            <div class="text-center p-4">
                <i class="fas fa-atom fa-4x text-info mb-3"></i>
                <h6>${nombre || 'Mol칠cula'}</h6>
                <p class="text-muted">Simulador ${tipo.toUpperCase()}</p>
                ${smiles ? `<small class="text-info">SMILES: ${smiles}</small>` : ''}
            </div>
        </div>
    `;
    
    console.log(`游빍 Vista previa de simulador: ${nombre} (${tipo})`);
}

function buscarMoleculaPubChem() {
    const nombre = document.getElementById('nombre-molecula').value;
    
    if (!nombre) {
        mostrarAdvertencia('Ingrese el nombre de la mol칠cula');
        return;
    }
    
    console.log(`游댌 Buscando en PubChem: ${nombre}`);
    
    const loadingToast = mostrarCargando('Buscando en PubChem...');
    
    // Simular b칰squeda en PubChem
    setTimeout(() => {
        loadingToast.hide();
        
        // Datos de ejemplo
        const ejemplosSMILES = {
            'etanol': 'CCO',
            'benceno': 'c1ccccc1',
            'cafeina': 'CN1C=NC2=C1C(=O)N(C(=O)N2C)C',
            'agua': 'O',
            'metano': 'C'
        };
        
        const smiles = ejemplosSMILES[nombre.toLowerCase()] || 'CCO';
        document.getElementById('smiles-molecula').value = smiles;
        
        mostrarExito(`SMILES encontrado: ${smiles}`);
        previsualizarSimulador();
    }, 2000);
}

// ===== FUNCI칍N PRINCIPAL DE SUBIDA =====

function subirRecurso(tipo) {
    if (!preguntaActual) {
        mostrarError('Error: No se pudo identificar la pregunta');
        return;
    }
    
    console.log(`游닋 Subiendo recurso ${tipo} para pregunta ${preguntaActual}`);
    
    // Validar campos seg칰n el tipo
    if (!validarRecurso(tipo)) {
        return;
    }
    
    const loadingToast = mostrarCargando(`Cargando ${tipo}...`);
    
    // Preparar datos para env칤o
    const formData = new FormData();
    formData.append('pregunta_id', preguntaActual);
    formData.append('tipo_recurso', tipo);
    formData.append('csrfmiddlewaretoken', getCookie('csrftoken'));
    
    // Agregar datos espec칤ficos seg칰n el tipo
    agregarDatosRecurso(formData, tipo);
    
    // Enviar al servidor
    fetch('/docente/cuestionario/subir-recurso/', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        loadingToast.hide();
        
        if (data.success) {
            mostrarExito(`${tipo.charAt(0).toUpperCase() + tipo.slice(1)} cargado exitosamente`);
            
            // Cerrar modal
            const modalId = `modalRecurso${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`;
            const modal = bootstrap.Modal.getInstance(document.getElementById(modalId));
            modal.hide();
            
            // Actualizar vista de recursos cargados
            actualizarRecursosCargados(preguntaActual);
            
        } else {
            mostrarError('Error: ' + (data.error || `Error al cargar ${tipo}`));
        }
    })
    .catch(error => {
        loadingToast.hide();
        console.error('Error:', error);
        mostrarError(`Error de conexi칩n al cargar ${tipo}`);
    });
}

function validarRecurso(tipo) {
    switch (tipo) {
        case 'imagen':
            const archivoImagen = document.getElementById('archivo-imagen').files[0];
            if (!archivoImagen) {
                mostrarError('Seleccione una imagen');
                return false;
            }
            if (archivoImagen.size > 10 * 1024 * 1024) {
                mostrarError('La imagen no puede superar 10MB');
                return false;
            }
            break;
            
        case 'video':
            const archivoVideo = document.getElementById('archivo-video').files[0];
            if (!archivoVideo) {
                mostrarError('Seleccione un video');
                return false;
            }
            if (archivoVideo.size > 50 * 1024 * 1024) {
                mostrarError('El video no puede superar 50MB');
                return false;
            }
            break;
            
        case 'youtube':
            const urlYoutube = document.getElementById('url-youtube').value;
            if (!urlYoutube) {
                mostrarError('Ingrese la URL del video de YouTube');
                return false;
            }
            if (!extraerYouTubeId(urlYoutube)) {
                mostrarError('URL de YouTube no v치lida');
                return false;
            }
            break;
            
        case 'documento':
            const archivoDoc = document.getElementById('archivo-documento').files[0];
            const tituloDoc = document.getElementById('titulo-documento').value;
            if (!archivoDoc) {
                mostrarError('Seleccione un documento');
                return false;
            }
            if (!tituloDoc.trim()) {
                mostrarError('Ingrese un t칤tulo para el documento');
                return false;
            }
            if (archivoDoc.size > 25 * 1024 * 1024) {
                mostrarError('El documento no puede superar 25MB');
                return false;
            }
            break;
            
        case 'simulador':
            const nombreMol = document.getElementById('nombre-molecula').value;
            if (!nombreMol.trim()) {
                mostrarError('Ingrese el nombre de la mol칠cula');
                return false;
            }
            break;
            
        case 'audio':
            const archivoAudio = document.getElementById('archivo-audio').files[0];
            if (!archivoAudio) {
                mostrarError('Seleccione un archivo de audio');
                return false;
            }
            if (archivoAudio.size > 10 * 1024 * 1024) {
                mostrarError('El audio no puede superar 10MB');
                return false;
            }
            break;
    }
    
    return true;
}

function agregarDatosRecurso(formData, tipo) {
    switch (tipo) {
        case 'imagen':
            formData.append('archivo', document.getElementById('archivo-imagen').files[0]);
            formData.append('descripcion', document.getElementById('descripcion-imagen').value);
            break;
            
        case 'video':
            formData.append('archivo', document.getElementById('archivo-video').files[0]);
            formData.append('descripcion', document.getElementById('descripcion-video').value);
            break;
            
        case 'youtube':
            const urlYoutube = document.getElementById('url-youtube').value;
            const videoId = extraerYouTubeId(urlYoutube);
            formData.append('youtube_id', videoId);
            formData.append('descripcion', document.getElementById('descripcion-youtube').value);
            break;
            
        case 'documento':
            formData.append('archivo', document.getElementById('archivo-documento').files[0]);
            formData.append('titulo', document.getElementById('titulo-documento').value);
            formData.append('descripcion', document.getElementById('descripcion-documento').value);
            break;
            
        case 'simulador':
            formData.append('nombre_molecula', document.getElementById('nombre-molecula').value);
            formData.append('smiles', document.getElementById('smiles-molecula').value);
            formData.append('descripcion', document.getElementById('descripcion-simulador').value);
            formData.append('tipo_simulador', document.getElementById('tipo-simulador').value);
            break;
            
        case 'audio':
            formData.append('archivo', document.getElementById('archivo-audio').files[0]);
            formData.append('descripcion', document.getElementById('descripcion-audio').value);
            break;
    }
}

function eliminarRecurso(tipo, preguntaId) {
    console.log(`游딈勇 Eliminando recurso ${tipo} de pregunta ${preguntaId}`);
    
    mostrarConfirmacionElegante(
        'Eliminar Recurso',
        `쮼st치s seguro de que quieres eliminar este ${tipo}?`,
        function() {
            const loadingToast = mostrarCargando('Eliminando recurso...');
            
            fetch('/docente/cuestionario/eliminar-recurso-pregunta/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({
                    pregunta_id: preguntaId,
                    tipo: tipo
                })
            })
            .then(response => response.json())
            .then(data => {
                loadingToast.hide();
                
                if (data.success) {
                    mostrarExito('Recurso eliminado exitosamente');
                    actualizarRecursosCargados(preguntaId);
                } else {
                    mostrarError('Error: ' + (data.error || 'Error al eliminar recurso'));
                }
            })
            .catch(error => {
                loadingToast.hide();
                console.error('Error:', error);
                mostrarError('Error de conexi칩n al eliminar recurso');
            });
        }
    );
}

function actualizarRecursosCargados(preguntaId) {
    const container = document.getElementById(`recursos-actuales-${preguntaId}`);
    if (container) {
        // Recargar la secci칩n de recursos cargados
        setTimeout(() => {
            window.location.reload();
        }, 1000);
    }
}

// ===== FUNCIONES DE UTILIDAD =====

function duplicarPregunta(preguntaId) {
    console.log(`游늶 Duplicando pregunta ${preguntaId}...`);
    
    mostrarConfirmacionElegante(
        'Duplicar Pregunta',
        '쮻eseas crear una copia de esta pregunta?',
        function() {
            const loadingToast = mostrarCargando('Duplicando pregunta...');
            
            fetch('/docente/cuestionario/duplicar-pregunta/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({
                    pregunta_id: preguntaId
                })
            })
            .then(response => response.json())
            .then(data => {
                loadingToast.hide();
                
                if (data.success) {
                    mostrarExito('Pregunta duplicada exitosamente');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    mostrarError('Error: ' + (data.error || 'Error al duplicar pregunta'));
                }
            })
            .catch(error => {
                loadingToast.hide();
                console.error('Error:', error);
                mostrarError('Error de conexi칩n al duplicar pregunta');
            });
        }
    );
}

// Funciones de notificaci칩n (deben estar definidas en el archivo principal)
function mostrarCargando(mensaje) {
    if (typeof window.crearCuestionario !== 'undefined' && 
        typeof window.crearCuestionario.mostrarCargando === 'function') {
        return window.crearCuestionario.mostrarCargando(mensaje);
    }
    console.log('낍 ' + mensaje);
    return { hide: () => {} };
}

function mostrarExito(mensaje) {
    if (typeof window.crearCuestionario !== 'undefined' && 
        typeof window.crearCuestionario.mostrarExito === 'function') {
        window.crearCuestionario.mostrarExito(mensaje);
    } else {
        console.log('九 ' + mensaje);
    }
}

function mostrarError(mensaje) {
    if (typeof window.crearCuestionario !== 'undefined' && 
        typeof window.crearCuestionario.mostrarError === 'function') {
        window.crearCuestionario.mostrarError(mensaje);
    } else {
        console.error('仇 ' + mensaje);
    }
}

function mostrarAdvertencia(mensaje) {
    if (typeof window.crearCuestionario !== 'undefined' && 
        typeof window.crearCuestionario.mostrarInfo === 'function') {
        window.crearCuestionario.mostrarInfo(mensaje);
    } else {
        console.warn('丘멆잺 ' + mensaje);
    }
}

function mostrarConfirmacionElegante(titulo, mensaje, callback) {
    if (typeof window.crearCuestionario !== 'undefined' && 
        typeof window.crearCuestionario.mostrarConfirmacion === 'function') {
        window.crearCuestionario.mostrarConfirmacion(titulo, mensaje, callback);
    } else {
        if (confirm(mensaje)) {
            callback();
        }
    }
}

function getCookie(name) {
    if (typeof window.crearCuestionario !== 'undefined' && 
        typeof window.crearCuestionario.getCookie === 'function') {
        return window.crearCuestionario.getCookie(name);
    }
    
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// ===== EVENT LISTENERS PARA VISTA PREVIA AUTOM츼TICA =====

document.addEventListener('DOMContentLoaded', function() {
    // Vista previa autom치tica para im치genes
    document.addEventListener('change', function(e) {
        if (e.target.id === 'archivo-imagen') {
            const file = e.target.files[0];
            const preview = document.getElementById('preview-imagen');
            
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.className = 'preview-area has-content';
                    preview.innerHTML = `
                        <img src="${e.target.result}" alt="Vista previa">
                        <p class="text-success mt-2">
                            <i class="fas fa-check me-1"></i>
                            ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)
                        </p>
                    `;
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Vista previa autom치tica para videos
        if (e.target.id === 'archivo-video') {
            const file = e.target.files[0];
            const preview = document.getElementById('preview-video');
            
            if (file && file.type.startsWith('video/')) {
                const url = URL.createObjectURL(file);
                preview.className = 'preview-area has-content';
                preview.innerHTML = `
                    <video controls style="max-width: 100%; max-height: 150px;">
                        <source src="${url}" type="${file.type}">
                    </video>
                    <p class="text-success mt-2">
                        <i class="fas fa-check me-1"></i>
                        ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)
                    </p>
                `;
            }
        }
        
        // Vista previa autom치tica para documentos
        if (e.target.id === 'archivo-documento') {
            const file = e.target.files[0];
            const preview = document.getElementById('preview-documento');
            
            if (file) {
                preview.className = 'preview-area has-content';
                
                const iconMap = {
                    'application/pdf': 'fas fa-file-pdf text-danger',
                    'application/msword': 'fas fa-file-word text-primary',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'fas fa-file-word text-primary',
                    'application/vnd.ms-powerpoint': 'fas fa-file-powerpoint text-warning',
                    'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'fas fa-file-powerpoint text-warning',
                    'text/plain': 'fas fa-file-alt text-secondary'
                };
                
                const icon = iconMap[file.type] || 'fas fa-file text-muted';
                
                preview.innerHTML = `
                    <div class="doc-info">
                        <div class="d-flex align-items-center mb-2">
                            <i class="${icon} fa-2x me-3"></i>
                            <div>
                                <h6 class="mb-1">${file.name}</h6>
                                <small class="text-muted">${(file.size / 1024 / 1024).toFixed(2)} MB</small>
                            </div>
                        </div>
                        <div class="text-success">
                            <i class="fas fa-check me-1"></i>
                            Documento listo para cargar
                        </div>
                    </div>
                `;
                
                // Auto-llenar t칤tulo si est치 vac칤o
                const tituloInput = document.getElementById('titulo-documento');
                if (!tituloInput.value) {
                    const nombreSinExtension = file.name.split('.').slice(0, -1).join('.');
                    tituloInput.value = nombreSinExtension;
                }
            }
        }
        
        // Vista previa autom치tica para audio
        if (e.target.id === 'archivo-audio') {
            const file = e.target.files[0];
            const preview = document.getElementById('preview-audio');
            
            if (file && file.type.startsWith('audio/')) {
                const url = URL.createObjectURL(file);
                preview.className = 'preview-area has-content';
                preview.innerHTML = `
                    <audio controls style="width: 100%;">
                        <source src="${url}" type="${file.type}">
                    </audio>
                    <p class="text-success mt-2">
                        <i class="fas fa-check me-1"></i>
                        ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)
                    </p>
                `;
            }
        }
    });
    
    // Vista previa autom치tica para YouTube al escribir
    document.addEventListener('input', function(e) {
        if (e.target.id === 'url-youtube') {
            // Debounce para evitar muchas llamadas
            clearTimeout(e.target.debounceTimer);
            e.target.debounceTimer = setTimeout(() => {
                previsualizarYoutube();
            }, 500);
        }
    });
    
    // Auto-preview para simulador al cambiar campos
    document.addEventListener('input', function(e) {
        if (['nombre-molecula', 'smiles-molecula', 'tipo-simulador'].includes(e.target.id)) {
            clearTimeout(e.target.debounceTimer);
            e.target.debounceTimer = setTimeout(() => {
                previsualizarSimulador();
            }, 1000);
        }
    });
    
    console.log('九 Sistema de recursos multimedia inicializado');
});

// ===== FUNCIONES PRINCIPALES COMPARTIDAS =====

function guardarPregunta(element) {
    const preguntaId = obtenerPreguntaId(element);
    if (!preguntaId) {
        mostrarError('No se pudo obtener el ID de pregunta');
        return;
    }
    
    console.log(`游 Guardando pregunta ${preguntaId}...`);
    
    // Llamar a la funci칩n global de guardado
    if (typeof window.guardarPregunta === 'function') {
        window.guardarPregunta(element);
    } else {
        console.error('Funci칩n guardarPregunta no encontrada en el contexto global');
        mostrarError('Error: Funci칩n de guardado no disponible');
    }
}

function iniciarCambioTipo(preguntaId) {
    console.log(`游댃 Iniciando cambio de tipo para pregunta: ${preguntaId}`);
    
    // Llamar a la funci칩n global
    if (typeof window.iniciarCambioTipo === 'function') {
        window.iniciarCambioTipo(preguntaId);
    } else {
        console.error('Funci칩n iniciarCambioTipo no encontrada en el contexto global');
        mostrarError('Error: Funci칩n de cambio de tipo no disponible');
    }
}

function eliminarPreguntaExistente(element) {
    const preguntaId = obtenerPreguntaId(element);
    if (!preguntaId) {
        mostrarError('No se pudo obtener el ID de pregunta');
        return;
    }
    
    console.log(`游딈勇 Eliminando pregunta: ${preguntaId}`);
    
    // Llamar a la funci칩n global
    if (typeof window.eliminarPreguntaExistente === 'function') {
        window.eliminarPreguntaExistente(element);
    } else {
        console.error('Funci칩n eliminarPreguntaExistente no encontrada en el contexto global');
        mostrarError('Error: Funci칩n de eliminaci칩n no disponible');
    }
}

// Funci칩n de utilidad compartida
function obtenerPreguntaId(element) {
    let current = element;
    while (current && current !== document) {
        if (current.dataset && current.dataset.preguntaId) {
            return current.dataset.preguntaId;
        }
        
        if (current.getAttribute && current.getAttribute('data-pregunta-id')) {
            return current.getAttribute('data-pregunta-id');
        }
        
        if (current.id) {
            const match = current.id.match(/_(\d+)$/);
            if (match) {
                return match[1];
            }
        }
        
        const preguntaParent = current.closest('[data-pregunta-id]');
        if (preguntaParent) {
            return preguntaParent.dataset.preguntaId;
        }
        
        current = current.parentElement;
    }
    
    console.warn("丘멆잺 No se pudo obtener el ID de pregunta desde:", element);
    return null;
}

console.log('游늶 Plantilla pregunta adaptada - Sistema completo con recursos multimedia cargado');
console.log('游늹 Funcionalidad de recursos: 九');
console.log('游꿛 Interfaz profesional: 九');
console.log('游님 Dise침o responsive: 九');
console.log('游댢 Modales funcionales: 九');
</script>
