<!-- plantilla_pregunta_adaptada.html - VERSI√ìN COMPLETA Y CORREGIDA -->
<div class="plantilla-pregunta" data-tipo="{{ pregunta.tipo.nombre }}" data-pregunta-id="{{ pregunta.id }}">
    
    <!-- Encabezado com√∫n de la pregunta -->
    <div class="row mb-3">
        <div class="col-md-8">
            <label class="form-label fw-bold">
                <i class="fas fa-question-circle me-2 text-primary"></i>
                Enunciado de la pregunta
            </label>
            <textarea class="form-control" rows="3" 
                      placeholder="Escribe el enunciado de tu pregunta aqu√≠..."
                      data-field="enunciado"
                      data-pregunta-id="{{ pregunta.id }}">{{ pregunta.enunciado|default:"" }}</textarea>
            <small class="text-muted">
                <i class="fas fa-lightbulb me-1"></i>
                Escribe una pregunta clara y espec√≠fica que los estudiantes puedan entender f√°cilmente.
            </small>
        </div>
        <div class="col-md-4">
            <div class="row">
                <div class="col-6">
                    <label class="form-label fw-bold">
                        <i class="fas fa-star me-2 text-warning"></i>
                        Puntaje
                    </label>
                    <div class="input-group">
                        <input type="number" class="form-control" value="{{ pregunta.puntaje|default:1 }}" 
                               min="1" step="1" data-field="puntaje" data-pregunta-id="{{ pregunta.id }}">
                        <span class="input-group-text">pts</span>
                    </div>
                    <small class="text-muted">Puntos que vale esta pregunta</small>
                </div>
                <div class="col-6">
                    <label class="form-label fw-bold">
                        <i class="fas fa-user-check me-2 text-info"></i>
                        Calificaci√≥n
                    </label>
                    <div class="calificacion-manual">
                        <input type="checkbox" id="calificacion-manual-{{ pregunta.id }}" 
                               data-field="calificacion_manual"
                               data-pregunta-id="{{ pregunta.id }}"
                               {% if pregunta.calificacion_manual %}checked{% endif %}>
                        <label for="calificacion-manual-{{ pregunta.id }}" class="small">
                            Manual
                        </label>
                    </div>
                    <small class="text-muted d-block">Marcar si requiere revisi√≥n manual</small>
                </div>
            </div>
        </div>
    </div>

    <!-- SECCI√ìN DE RECURSOS MULTIMEDIA -->
    <div class="recursos-multimedia-section">
        <!-- Toggle button -->
        <button type="button" class="recursos-apoyo-toggle" 
                data-bs-toggle="collapse" 
                data-bs-target="#recursos-{{ pregunta.id }}" 
                aria-expanded="false"
                onclick="toggleRecursosApoyo(this)">
            <i class="fas fa-paperclip me-2"></i>
            <span>Recursos de apoyo (opcional)</span>
            <i class="fas fa-chevron-down ms-auto toggle-icon"></i>
        </button>
        
        <!-- Contenido de recursos (colapsable) -->
        <div class="collapse" id="recursos-{{ pregunta.id }}">
            <div class="recursos-content">
                <div class="recursos-header">
                    <h6 class="mb-3">
                        <i class="fas fa-layer-group me-2 text-primary"></i>
                        Tipo de recurso multimedia
                    </h6>
                </div>
                
                <!-- Botones de recursos -->
                <div class="row g-3 mb-4">
                    <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                        <div class="recurso-card" onclick="mostrarModalSimple('imagen', {{ pregunta.id }})">
                            <div class="recurso-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <div class="recurso-title">Imagen</div>
                            <div class="recurso-subtitle">JPG, PNG, GIF</div>
                        </div>
                    </div>
                    
                    <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                        <div class="recurso-card" onclick="mostrarModalSimple('video', {{ pregunta.id }})">
                            <div class="recurso-icon">
                                <i class="fas fa-video"></i>
                            </div>
                            <div class="recurso-title">Video</div>
                            <div class="recurso-subtitle">MP4, WebM</div>
                        </div>
                    </div>
                    
                    <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                        <div class="recurso-card" onclick="mostrarModalSimple('youtube', {{ pregunta.id }})">
                            <div class="recurso-icon">
                                <i class="fab fa-youtube"></i>
                            </div>
                            <div class="recurso-title">YouTube</div>
                            <div class="recurso-subtitle">URL de video</div>
                        </div>
                    </div>
                    
                    <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                        <div class="recurso-card" onclick="mostrarModalSimple('documento', {{ pregunta.id }})">
                            <div class="recurso-icon">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <div class="recurso-title">Documento</div>
                            <div class="recurso-subtitle">PDF, DOC, PPT</div>
                        </div>
                    </div>
                    
                    <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                        <div class="recurso-card" onclick="mostrarModalSimple('audio', {{ pregunta.id }})">
                            <div class="recurso-icon">
                                <i class="fas fa-volume-up"></i>
                            </div>
                            <div class="recurso-title">Audio</div>
                            <div class="recurso-subtitle">MP3, WAV</div>
                        </div>
                    </div>
                </div>
                
                <!-- Consejos -->
                <div class="recursos-tips">
                    <div class="alert alert-info border-0">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Consejos para recursos efectivos:</strong>
                        <ul class="mb-0 mt-2">
                            <li>Las im√°genes deben ser claras y relevantes al contenido</li>
                            <li>Los videos de YouTube deben estar relacionados con la pregunta</li>
                            <li>Los documentos PDF deben ser legibles y no muy extensos</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Recursos cargados -->
                <div class="recursos-actuales" id="recursos-actuales-{{ pregunta.id }}">
                    {% if pregunta.archivo_multimedia or pregunta.url_youtube %}
                    <h6 class="mb-3">
                        <i class="fas fa-check-circle me-2 text-success"></i>
                        Recursos cargados
                    </h6>
                    <div class="recursos-lista">
                        {% if pregunta.archivo_multimedia %}
                        <div class="recurso-item">
                            <div class="recurso-info">
                                <i class="fas fa-file me-2"></i>
                                <span>{{ pregunta.archivo_multimedia.name|default:"Archivo multimedia" }}</span>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                    onclick="eliminarRecurso('archivo', {{ pregunta.id }})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        {% endif %}
                        
                        {% if pregunta.url_youtube %}
                        <div class="recurso-item">
                            <div class="recurso-info">
                                <i class="fab fa-youtube me-2 text-danger"></i>
                                <span>Video de YouTube: {{ pregunta.url_youtube }}</span>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-danger" 
                                    onclick="eliminarRecurso('youtube', {{ pregunta.id }})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                
                <!-- Limitaciones -->
                <div class="recursos-limitaciones">
                    <small class="text-muted">
                        <i class="fas fa-exclamation-triangle me-1"></i>
                        L√≠mites: 10MB im√°genes, 50MB videos, 25MB documentos
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- CONTENIDO ESPEC√çFICO POR TIPO DE PREGUNTA -->
    <div class="tipo-pregunta-content">
        {% if pregunta.tipo.nombre == 'opcion_unica' or pregunta.tipo.nombre == 'opcion_multiple' or pregunta.tipo.nombre == 'falso_verdadero' %}
            {% include 'docente/plantillas/plantilla_opciones.html' %}
        {% elif pregunta.tipo.nombre == 'respuesta_abierta' %}
            {% include 'docente/plantillas/plantilla_respuesta_abierta.html' %}
        {% elif pregunta.tipo.nombre == 'simulador_2d' or pregunta.tipo.nombre == 'simulador_3d' %}
            {% include 'docente/plantillas/plantilla_simuladores.html' %}
        {% elif pregunta.tipo.nombre == 'unir_lineas' %}
            {% include 'docente/plantillas/plantilla_unir_lineas.html' %}
        {% elif pregunta.tipo.nombre == 'completar' %}
            {% include 'docente/plantillas/plantilla_completar.html' %}
        {% else %}
            <div class="tipo-desconocido-container">
                <div class="alert alert-warning border-0">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Tipo de pregunta "{{ pregunta.tipo.nombre }}" no est√° configurado a√∫n.</strong>
                    <br><small>Contacta al administrador para agregar soporte para este tipo.</small>
                </div>
            </div>
        {% endif %}
    </div>
    
    <!-- Acciones de la pregunta -->
    <div class="pregunta-actions">
        <button type="button" class="btn btn-success btn-sm action-btn" 
                data-pregunta-id="{{ pregunta.id }}"
                onclick="guardarPregunta(this)"
                title="Guardar todos los cambios realizados">
            <i class="fas fa-save me-1"></i>Guardar cambios
        </button>
        
        <button type="button" class="btn btn-warning btn-sm action-btn" 
                data-pregunta-id="{{ pregunta.id }}"
                onclick="iniciarCambioTipo({{ pregunta.id }})"
                title="Cambiar el tipo de esta pregunta">
            <i class="fas fa-exchange-alt me-1"></i>Cambiar tipo
        </button>
        
        <button type="button" class="btn btn-info btn-sm action-btn" 
                data-pregunta-id="{{ pregunta.id }}"
                onclick="duplicarPregunta({{ pregunta.id }})"
                title="Crear una copia de esta pregunta">
            <i class="fas fa-copy me-1"></i>Duplicar
        </button>
        
        <button type="button" class="btn btn-danger btn-sm action-btn" 
                data-pregunta-id="{{ pregunta.id }}"
                onclick="eliminarPreguntaExistente(this)"
                title="Eliminar esta pregunta permanentemente">
            <i class="fas fa-trash me-1"></i>Eliminar
        </button>
        
        <!-- Informaci√≥n adicional -->
        <div class="ms-auto d-flex align-items-center">
            <span class="pregunta-info">
                <i class="fas fa-info-circle me-1"></i>
                <strong>{{ pregunta.tipo.descripcion|title }}</strong> | 
                Orden: {{ pregunta.orden }} | 
                Puntos: {{ pregunta.puntaje }}
                {% if pregunta.fecha_creacion %}
                | {{ pregunta.fecha_creacion|date:"d/m/Y" }}
                {% endif %}
            </span>
        </div>
    </div>
</div>

<!-- ESTILOS CSS PROFESIONALES -->
<style>
/* ===== ESTILOS BASE PARA LA PLANTILLA ===== */
.plantilla-pregunta {
    border: 1px solid #e8ecef;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 20px;
    background: #ffffff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    transition: all 0.3s ease;
    position: relative;
}

.plantilla-pregunta:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    border-color: #0066cc;
}

.plantilla-pregunta::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: linear-gradient(to bottom, #0066cc, #004499);
    border-radius: 12px 0 0 12px;
}

/* ===== CAMPOS DE FORMULARIO MEJORADOS ===== */
.form-label {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 8px;
    color: #2c3e50;
    display: flex;
    align-items: center;
}

.form-control {
    font-size: 1rem;
    padding: 12px 16px;
    border: 1px solid #dde2e6;
    border-radius: 8px;
    background-color: #ffffff;
    transition: all 0.2s ease;
}

.form-control:focus {
    border-color: #0066cc;
    box-shadow: 0 0 0 0.2rem rgba(0, 102, 204, 0.1);
    background-color: #ffffff;
}

.form-control:hover {
    border-color: #b8c5d1;
}

/* ===== SECCI√ìN DE RECURSOS MULTIMEDIA ===== */
.recursos-multimedia-section {
    margin: 20px 0;
    border-top: 1px solid #f0f3f6;
    padding-top: 20px;
}

.recursos-apoyo-toggle {
    width: 100%;
    padding: 12px 20px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border: 1px solid #dee2e6;
    border-radius: 8px;
    color: #495057;
    font-weight: 500;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    cursor: pointer;
}

.recursos-apoyo-toggle:hover {
    background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
    color: #212529;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.recursos-apoyo-toggle.active {
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    border-color: #0066cc;
    color: #0066cc;
}

.toggle-icon {
    transition: transform 0.3s ease;
}

.recursos-apoyo-toggle[aria-expanded="true"] .toggle-icon {
    transform: rotate(180deg);
}

.recursos-content {
    background: #ffffff;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    margin-top: 12px;
}

.recursos-header h6 {
    color: #2c3e50;
    font-weight: 600;
}

/* ===== TARJETAS DE RECURSOS ===== */
.recurso-card {
    background: #ffffff;
    border: 1px solid #e9ecef;
    border-radius: 10px;
    padding: 16px 12px;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    height: 120px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
    overflow: hidden;
}

.recurso-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    width: 0;
    height: 3px;
    background: linear-gradient(90deg, #0066cc, #004499);
    transition: all 0.3s ease;
    transform: translateX(-50%);
}

.recurso-card:hover {
    border-color: #0066cc;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 102, 204, 0.15);
}

.recurso-card:hover::before {
    width: 100%;
}

.recurso-icon {
    font-size: 24px;
    color: #6c757d;
    margin-bottom: 8px;
    transition: color 0.3s ease;
}

.recurso-card:hover .recurso-icon {
    color: #0066cc;
}

.recurso-title {
    font-weight: 600;
    color: #2c3e50;
    font-size: 0.9rem;
    margin-bottom: 4px;
}

.recurso-subtitle {
    font-size: 0.75rem;
    color: #6c757d;
    line-height: 1.2;
}

/* ===== TIPS Y ALERTAS ===== */
.recursos-tips .alert {
    background: linear-gradient(135deg, #e8f4fd 0%, #f0f8ff 100%);
    border-left: 4px solid #0066cc;
    color: #2c3e50;
}

.recursos-tips ul {
    padding-left: 20px;
    font-size: 0.9rem;
}

.recursos-tips li {
    margin-bottom: 4px;
}

/* ===== RECURSOS ACTUALES ===== */
.recursos-actuales h6 {
    color: #28a745;
    font-weight: 600;
}

.recurso-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 15px;
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    margin-bottom: 8px;
}

.recurso-info {
    display: flex;
    align-items: center;
    color: #495057;
    font-weight: 500;
}

/* ===== CALIFICACI√ìN MANUAL ===== */
.calificacion-manual {
    background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%);
    border: 1px solid #f39c12;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 8px;
    min-height: 40px;
}

.calificacion-manual input[type="checkbox"] {
    margin: 0;
    transform: scale(1.2);
    accent-color: #f39c12;
}

.calificacion-manual label {
    margin: 0;
    font-weight: 600;
    cursor: pointer;
    color: #856404;
}

/* ===== ACCIONES DE PREGUNTA ===== */
.pregunta-actions {
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid #f0f3f6;
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}

.action-btn {
    font-weight: 500;
    border-radius: 6px;
    transition: all 0.2s ease;
    border: none;
    font-size: 0.9rem;
    padding: 8px 16px;
}

.action-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 8px rgba(0,0,0,0.15);
}

.pregunta-info {
    background: #f8f9fa;
    padding: 8px 12px;
    border-radius: 6px;
    border: 1px solid #e9ecef;
    font-size: 0.8rem;
    color: #6c757d;
}

/* ===== LIMITACIONES ===== */
.recursos-limitaciones {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid #f0f3f6;
    text-align: center;
}

/* ===== TIPO DESCONOCIDO ===== */
.tipo-desconocido-container .alert {
    border-left: 4px solid #dc3545;
    background: linear-gradient(135deg, #fdf2f2 0%, #fce4ec 100%);
    color: #721c24;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
    .plantilla-pregunta {
        padding: 16px;
        margin-bottom: 16px;
    }
    
    .pregunta-actions {
        flex-direction: column;
        align-items: stretch;
    }
    
    .action-btn {
        margin-bottom: 8px;
        width: 100%;
    }
    
    .pregunta-actions .ms-auto {
        margin-left: 0 !important;
        margin-top: 12px;
    }
    
    .calificacion-manual {
        min-height: 36px;
        padding: 6px 10px;
    }
    
    .recurso-card {
        height: 100px;
        padding: 12px 8px;
    }
    
    .recurso-icon {
        font-size: 20px;
        margin-bottom: 6px;
    }
    
    .recurso-title {
        font-size: 0.8rem;
    }
    
    .recurso-subtitle {
        font-size: 0.7rem;
    }
}

@media (max-width: 576px) {
    .recursos-content {
        padding: 15px;
    }
    
    .recursos-apoyo-toggle {
        padding: 10px 15px;
        font-size: 0.9rem;
    }
}
</style>

<!-- JAVASCRIPT PARA FUNCIONALIDAD -->
<script>
// ===== VARIABLES GLOBALES =====
let preguntaActual = null;

// ===== FUNCIONES PRINCIPALES =====

function toggleRecursosApoyo(element) {
    const icon = element.querySelector('.toggle-icon');
    const isExpanded = element.getAttribute('aria-expanded') === 'true';
    
    if (isExpanded) {
        element.classList.add('active');
    } else {
        element.classList.remove('active');
    }
    
    console.log(`üìé Recursos de apoyo ${isExpanded ? 'expandidos' : 'colapsados'}`);
}

function mostrarModalSimple(tipo, preguntaId) {
    console.log(`üéØ Abriendo modal: ${tipo} para pregunta ${preguntaId}`);
    
    preguntaActual = preguntaId;
    
    // Crear modal din√°micamente
    const modalHtml = `
        <div class="modal fade" id="modalTemporal" tabindex="-1">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title">
                            <i class="fas fa-${getIconoTipo(tipo)} me-2"></i>
                            Cargar ${tipo.charAt(0).toUpperCase() + tipo.slice(1)}
                        </h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        ${getModalContent(tipo)}
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" onclick="subirRecursoSimple('${tipo}', ${preguntaId})">
                            <i class="fas fa-upload me-1"></i>Cargar ${tipo}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Remover modal anterior si existe
    const modalAnterior = document.getElementById('modalTemporal');
    if (modalAnterior) {
        modalAnterior.remove();
    }
    
    // Agregar nuevo modal
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    
    // Mostrar modal
    const modal = new bootstrap.Modal(document.getElementById('modalTemporal'));
    modal.show();
}

function getIconoTipo(tipo) {
    const iconos = {
        'imagen': 'image',
        'video': 'video',
        'youtube': 'youtube',
        'documento': 'file-alt',
        'audio': 'volume-up'
    };
    return iconos[tipo] || 'file';
}

function getModalContent(tipo) {
    switch(tipo) {
        case 'imagen':
            return `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Seleccionar imagen</label>
                            <input type="file" class="form-control" id="temp-archivo-${tipo}" accept="image/*" onchange="previsualizarArchivo(this, 'imagen')">
                            <small class="text-muted">Formatos: JPG, PNG, GIF (m√°x. 10MB)</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Descripci√≥n (opcional)</label>
                            <input type="text" class="form-control" id="temp-descripcion-${tipo}" placeholder="Descripci√≥n de la imagen">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="preview-container">
                            <div id="preview-temp" class="preview-area">
                                <i class="fas fa-image fa-3x text-muted"></i>
                                <p class="text-muted mt-2">Vista previa aparecer√° aqu√≠</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        case 'video':
            return `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Seleccionar video</label>
                            <input type="file" class="form-control" id="temp-archivo-${tipo}" accept="video/*" onchange="previsualizarArchivo(this, 'video')">
                            <small class="text-muted">Formatos: MP4, WebM, AVI (m√°x. 50MB)</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Descripci√≥n (opcional)</label>
                            <input type="text" class="form-control" id="temp-descripcion-${tipo}" placeholder="Descripci√≥n del video">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="preview-container">
                            <div id="preview-temp" class="preview-area">
                                <i class="fas fa-video fa-3x text-muted"></i>
                                <p class="text-muted mt-2">Vista previa aparecer√° aqu√≠</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        case 'youtube':
            return `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label fw-bold">URL de YouTube</label>
                            <input type="url" class="form-control" id="temp-url-${tipo}" placeholder="https://www.youtube.com/watch?v=..." onchange="previsualizarYoutube()">
                            <small class="text-muted">Pega la URL completa del video de YouTube</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Descripci√≥n (opcional)</label>
                            <input type="text" class="form-control" id="temp-descripcion-${tipo}" placeholder="Descripci√≥n del video">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="preview-container">
                            <div id="preview-temp" class="preview-area">
                                <i class="fab fa-youtube fa-3x text-muted"></i>
                                <p class="text-muted mt-2">Vista previa aparecer√° aqu√≠</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        case 'documento':
            return `
                <div class="mb-3">
                    <label class="form-label fw-bold">Seleccionar documento</label>
                    <input type="file" class="form-control" id="temp-archivo-${tipo}" accept=".pdf,.doc,.docx,.ppt,.pptx,.txt" onchange="previsualizarArchivo(this, 'documento')">
                    <small class="text-muted">Formatos: PDF, DOC, DOCX, PPT, PPTX, TXT (m√°x. 25MB)</small>
                </div>
                <div class="mb-3">
                    <label class="form-label">T√≠tulo del documento</label>
                    <input type="text" class="form-control" id="temp-titulo-${tipo}" placeholder="Nombre descriptivo del documento">
                </div>
                <div class="mb-3">
                    <label class="form-label">Descripci√≥n (opcional)</label>
                    <textarea class="form-control" rows="3" id="temp-descripcion-${tipo}" placeholder="Describe el contenido del documento"></textarea>
                </div>
                <div id="preview-temp" class="preview-area">
                    <i class="fas fa-file-alt fa-3x text-muted"></i>
                    <p class="text-muted mt-2">Informaci√≥n del documento aparecer√° aqu√≠</p>
                </div>
            `;
        case 'audio':
            return `
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Seleccionar audio</label>
                            <input type="file" class="form-control" id="temp-archivo-${tipo}" accept="audio/*" onchange="previsualizarArchivo(this, 'audio')">
                            <small class="text-muted">Formatos: MP3, WAV, OGG (m√°x. 10MB)</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Descripci√≥n (opcional)</label>
                            <input type="text" class="form-control" id="temp-descripcion-${tipo}" placeholder="Descripci√≥n del audio">
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="preview-container">
                            <div id="preview-temp" class="preview-area">
                                <i class="fas fa-volume-up fa-3x text-muted"></i>
                                <p class="text-muted mt-2">Reproductor aparecer√° aqu√≠</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        default:
            return `<p>Formulario para ${tipo}</p>`;
    }
}

// ===== FUNCIONES DE VISTA PREVIA =====

function previsualizarArchivo(input, tipo) {
    const file = input.files[0];
    const preview = document.getElementById('preview-temp');
    
    if (!file || !preview) return;
    
    console.log(`üëÅÔ∏è Previsualizando ${tipo}:`, file.name);
    
    // Validar tama√±o
    const limites = {
        'imagen': 10 * 1024 * 1024,    // 10MB
        'video': 50 * 1024 * 1024,     // 50MB
        'documento': 25 * 1024 * 1024, // 25MB
        'audio': 10 * 1024 * 1024      // 10MB
    };
    
    if (file.size > limites[tipo]) {
        const limiteMB = (limites[tipo] / 1024 / 1024).toFixed(0);
        preview.innerHTML = `
            <i class="fas fa-exclamation-triangle fa-2x text-danger"></i>
            <p class="text-danger mt-2">Archivo muy grande. M√°ximo ${limiteMB}MB</p>
        `;
        input.value = '';
        return;
    }
    
    preview.className = 'preview-area has-content';
    
    switch(tipo) {
        case 'imagen':
            if (file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <img src="${e.target.result}" alt="Vista previa" style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                        <p class="text-success mt-2">
                            <i class="fas fa-check me-1"></i>
                            ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)
                        </p>
                    `;
                };
                reader.readAsDataURL(file);
            }
            break;
            
        case 'video':
            if (file.type.startsWith('video/')) {
                const url = URL.createObjectURL(file);
                preview.innerHTML = `
                    <video controls style="max-width: 100%; max-height: 200px; border-radius: 8px;">
                        <source src="${url}" type="${file.type}">
                    </video>
                    <p class="text-success mt-2">
                        <i class="fas fa-check me-1"></i>
                        ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)
                    </p>
                `;
            }
            break;
            
        case 'documento':
            const iconMap = {
                'application/pdf': 'fas fa-file-pdf text-danger',
                'application/msword': 'fas fa-file-word text-primary',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'fas fa-file-word text-primary',
                'application/vnd.ms-powerpoint': 'fas fa-file-powerpoint text-warning',
                'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'fas fa-file-powerpoint text-warning',
                'text/plain': 'fas fa-file-alt text-secondary'
            };
            
            const icon = iconMap[file.type] || 'fas fa-file text-muted';
            
            preview.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="${icon} fa-3x me-3"></i>
                    <div>
                        <h6 class="mb-1">${file.name}</h6>
                        <small class="text-muted">${(file.size / 1024 / 1024).toFixed(2)} MB</small>
                        <div class="text-success mt-1">
                            <i class="fas fa-check me-1"></i>
                            Documento listo para cargar
                        </div>
                    </div>
                </div>
            `;
            
            // Auto-llenar t√≠tulo si est√° vac√≠o
            const tituloInput = document.getElementById(`temp-titulo-documento`);
            if (tituloInput && !tituloInput.value) {
                const nombreSinExtension = file.name.split('.').slice(0, -1).join('.');
                tituloInput.value = nombreSinExtension;
            }
            break;
            
        case 'audio':
            if (file.type.startsWith('audio/')) {
                const url = URL.createObjectURL(file);
                preview.innerHTML = `
                    <audio controls style="width: 100%;">
                        <source src="${url}" type="${file.type}">
                    </audio>
                    <p class="text-success mt-2">
                        <i class="fas fa-check me-1"></i>
                        ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)
                    </p>
                `;
            }
            break;
    }
}

function previsualizarYoutube() {
    const urlInput = document.getElementById('temp-url-youtube');
    const preview = document.getElementById('preview-temp');
    
    if (!urlInput || !preview) return;
    
    const url = urlInput.value.trim();
    
    if (!url) {
        preview.className = 'preview-area';
        preview.innerHTML = `
            <i class="fab fa-youtube fa-3x text-muted"></i>
            <p class="text-muted mt-2">Vista previa aparecer√° aqu√≠</p>
        `;
        return;
    }
    
    // Extraer ID del video de YouTube
    const videoId = extraerYouTubeId(url);
    
    if (videoId) {
        preview.className = 'preview-area has-content';
        preview.innerHTML = `
            <iframe src="https://www.youtube.com/embed/${videoId}" 
                    width="100%" height="200"
                    frameborder="0" 
                    allowfullscreen
                    style="border-radius: 8px;">
            </iframe>
            <p class="text-success mt-2">
                <i class="fas fa-check me-1"></i>
                Video de YouTube v√°lido
            </p>
        `;
        console.log(`üé• Vista previa de YouTube cargada: ${videoId}`);
    } else {
        preview.className = 'preview-area';
        preview.innerHTML = `
            <i class="fas fa-exclamation-triangle fa-2x text-warning"></i>
            <p class="text-warning mt-2">URL de YouTube no v√°lida</p>
        `;
    }
}

function extraerYouTubeId(url) {
    const regex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;
    const match = url.match(regex);
    return match ? match[1] : null;
}

// ===== FUNCI√ìN DE SUBIR RECURSOS =====

function subirRecursoSimple(tipo, preguntaId) {
    console.log(`üì§ Subiendo ${tipo} para pregunta ${preguntaId}`);
    
    // Validar datos antes de enviar
    if (!validarDatosRecurso(tipo)) {
        return;
    }
    
    const formData = new FormData();
    formData.append('pregunta_id', preguntaId);
    formData.append('tipo_recurso', tipo);
    formData.append('csrfmiddlewaretoken', getCookie('csrftoken'));
    
    // Recopilar datos seg√∫n tipo
    agregarDatosAlFormData(formData, tipo);
    
    // Mostrar loading
    const loadingToast = mostrarCargando(`Cargando ${tipo}...`);
    
    // Enviar al servidor
    fetch('/docente/cuestionario/subir-recurso/', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        loadingToast.hide();
        
        if (data.success) {
            mostrarExito(`${tipo.charAt(0).toUpperCase() + tipo.slice(1)} cargado exitosamente`);
            
            // Cerrar modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('modalTemporal'));
            if (modal) modal.hide();
            
            // Recargar p√°gina para mostrar el recurso
            setTimeout(() => window.location.reload(), 1000);
        } else {
            mostrarError('Error: ' + (data.error || `Error al cargar ${tipo}`));
        }
    })
    .catch(error => {
        loadingToast.hide();
        console.error('Error:', error);
        mostrarError('Error de conexi√≥n al cargar recurso');
    });
}

function validarDatosRecurso(tipo) {
    switch(tipo) {
        case 'imagen':
        case 'video':
        case 'audio':
            const archivo = document.getElementById(`temp-archivo-${tipo}`);
            if (!archivo || !archivo.files[0]) {
                mostrarError(`Seleccione un archivo de ${tipo}`);
                return false;
            }
            break;
            
        case 'youtube':
            const urlYoutube = document.getElementById('temp-url-youtube');
            if (!urlYoutube || !urlYoutube.value.trim()) {
                mostrarError('Ingrese la URL del video de YouTube');
                return false;
            }
            if (!extraerYouTubeId(urlYoutube.value)) {
                mostrarError('URL de YouTube no v√°lida');
                return false;
            }
            break;
            
        case 'documento':
            const archivoDoc = document.getElementById('temp-archivo-documento');
            const tituloDoc = document.getElementById('temp-titulo-documento');
            if (!archivoDoc || !archivoDoc.files[0]) {
                mostrarError('Seleccione un documento');
                return false;
            }
            if (!tituloDoc || !tituloDoc.value.trim()) {
                mostrarError('Ingrese un t√≠tulo para el documento');
                return false;
            }
            break;
    }
    return true;
}

function agregarDatosAlFormData(formData, tipo) {
    const archivo = document.getElementById(`temp-archivo-${tipo}`);
    const descripcion = document.getElementById(`temp-descripcion-${tipo}`);
    const url = document.getElementById(`temp-url-${tipo}`);
    const titulo = document.getElementById(`temp-titulo-${tipo}`);
    
    // Agregar archivo si existe
    if (archivo && archivo.files[0]) {
        formData.append('archivo', archivo.files[0]);
    }
    
    // Agregar descripci√≥n si existe
    if (descripcion && descripcion.value.trim()) {
        formData.append('descripcion', descripcion.value.trim());
    }
    
    // Agregar URL para YouTube
    if (url && url.value.trim()) {
        const videoId = extraerYouTubeId(url.value);
        if (videoId) {
            formData.append('youtube_id', videoId);
        }
    }
    
    // Agregar t√≠tulo para documentos
    if (titulo && titulo.value.trim()) {
        formData.append('titulo', titulo.value.trim());
    }
}

// ===== FUNCIONES DE GESTI√ìN DE PREGUNTAS =====

function duplicarPregunta(preguntaId) {
    console.log(`üìã Duplicando pregunta ${preguntaId}...`);
    
    mostrarConfirmacionElegante(
        'Duplicar Pregunta',
        '¬øDeseas crear una copia de esta pregunta?',
        function() {
            const loadingToast = mostrarCargando('Duplicando pregunta...');
            
            fetch('/docente/cuestionario/duplicar-pregunta/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({
                    pregunta_id: preguntaId
                })
            })
            .then(response => response.json())
            .then(data => {
                loadingToast.hide();
                
                if (data.success) {
                    mostrarExito('Pregunta duplicada exitosamente');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    mostrarError('Error: ' + (data.error || 'Error al duplicar pregunta'));
                }
            })
            .catch(error => {
                loadingToast.hide();
                console.error('Error:', error);
                mostrarError('Error de conexi√≥n al duplicar pregunta');
            });
        }
    );
}

function eliminarRecurso(tipo, preguntaId) {
    console.log(`üóëÔ∏è Eliminando recurso ${tipo} de pregunta ${preguntaId}`);
    
    mostrarConfirmacionElegante(
        'Eliminar Recurso',
        `¬øEst√°s seguro de que quieres eliminar este ${tipo}?`,
        function() {
            const loadingToast = mostrarCargando('Eliminando recurso...');
            
            fetch('/docente/cuestionario/eliminar-recurso-pregunta/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: JSON.stringify({
                    pregunta_id: preguntaId,
                    tipo: tipo
                })
            })
            .then(response => response.json())
            .then(data => {
                loadingToast.hide();
                
                if (data.success) {
                    mostrarExito('Recurso eliminado exitosamente');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                } else {
                    mostrarError('Error: ' + (data.error || 'Error al eliminar recurso'));
                }
            })
            .catch(error => {
                loadingToast.hide();
                console.error('Error:', error);
                mostrarError('Error de conexi√≥n al eliminar recurso');
            });
        }
    );
}

// ===== FUNCIONES DE INTERFAZ CON EL SISTEMA PRINCIPAL =====

function guardarPregunta(element) {
    const preguntaId = obtenerPreguntaId(element);
    if (!preguntaId) {
        mostrarError('No se pudo obtener el ID de pregunta');
        return;
    }
    
    console.log(`üíæ Guardando pregunta ${preguntaId}...`);
    
    // Llamar a la funci√≥n global de guardado
    if (typeof window.guardarPregunta === 'function') {
        window.guardarPregunta(element);
    } else {
        console.error('Funci√≥n guardarPregunta no encontrada en el contexto global');
        mostrarError('Error: Funci√≥n de guardado no disponible');
    }
}

function iniciarCambioTipo(preguntaId) {
    console.log(`üîÑ Iniciando cambio de tipo para pregunta: ${preguntaId}`);
    
    // Llamar a la funci√≥n global
    if (typeof window.iniciarCambioTipo === 'function') {
        window.iniciarCambioTipo(preguntaId);
    } else {
        console.error('Funci√≥n iniciarCambioTipo no encontrada en el contexto global');
        mostrarError('Error: Funci√≥n de cambio de tipo no disponible');
    }
}

function eliminarPreguntaExistente(element) {
    const preguntaId = obtenerPreguntaId(element);
    if (!preguntaId) {
        mostrarError('No se pudo obtener el ID de pregunta');
        return;
    }
    
    console.log(`üóëÔ∏è Eliminando pregunta: ${preguntaId}`);
    
    // Llamar a la funci√≥n global
    if (typeof window.eliminarPreguntaExistente === 'function') {
        window.eliminarPreguntaExistente(element);
    } else {
        console.error('Funci√≥n eliminarPreguntaExistente no encontrada en el contexto global');
        mostrarError('Error: Funci√≥n de eliminaci√≥n no disponible');
    }
}

// ===== FUNCIONES DE UTILIDAD =====

function obtenerPreguntaId(element) {
    let current = element;
    while (current && current !== document) {
        if (current.dataset && current.dataset.preguntaId) {
            return current.dataset.preguntaId;
        }
        
        if (current.getAttribute && current.getAttribute('data-pregunta-id')) {
            return current.getAttribute('data-pregunta-id');
        }
        
        if (current.id) {
            const match = current.id.match(/_(\d+)$/);
            if (match) {
                return match[1];
            }
        }
        
        const preguntaParent = current.closest('[data-pregunta-id]');
        if (preguntaParent) {
            return preguntaParent.dataset.preguntaId;
        }
        
        current = current.parentElement;
    }
    
    console.warn("‚ö†Ô∏è No se pudo obtener el ID de pregunta desde:", element);
    return null;
}

function getCookie(name) {
    // Intentar usar la funci√≥n global si existe
    if (typeof window.crearCuestionario !== 'undefined' && 
        typeof window.crearCuestionario.getCookie === 'function') {
        return window.crearCuestionario.getCookie(name);
    }
    
    // Implementaci√≥n local como fallback
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// ===== FUNCIONES DE NOTIFICACI√ìN =====

function mostrarCargando(mensaje) {
    if (typeof window.crearCuestionario !== 'undefined' && 
        typeof window.crearCuestionario.mostrarCargando === 'function') {
        return window.crearCuestionario.mostrarCargando(mensaje);
    }
    
    console.log('‚è≥ ' + mensaje);
    
    // Fallback simple
    const loadingDiv = document.createElement('div');
    loadingDiv.id = 'loading-fallback';
    loadingDiv.innerHTML = `
        <div class="toast show position-fixed top-0 end-0 m-3" style="z-index: 9999;">
            <div class="toast-body bg-primary text-white">
                <div class="d-flex align-items-center">
                    <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                    ${mensaje}
                </div>
            </div>
        </div>
    `;
    document.body.appendChild(loadingDiv);
    
    return {
        hide: function() {
            const element = document.getElementById('loading-fallback');
            if (element) {
                element.remove();
            }
        }
    };
}

function mostrarExito(mensaje) {
    if (typeof window.crearCuestionario !== 'undefined' && 
        typeof window.crearCuestionario.mostrarExito === 'function') {
        window.crearCuestionario.mostrarExito(mensaje);
    } else {
        console.log('‚úÖ ' + mensaje);
        // Fallback simple
        mostrarToastFallback(mensaje, 'success');
    }
}

function mostrarError(mensaje) {
    if (typeof window.crearCuestionario !== 'undefined' && 
        typeof window.crearCuestionario.mostrarError === 'function') {
        window.crearCuestionario.mostrarError(mensaje);
    } else {
        console.error('‚ùå ' + mensaje);
        // Fallback simple
        mostrarToastFallback(mensaje, 'danger');
    }
}

function mostrarAdvertencia(mensaje) {
    if (typeof window.crearCuestionario !== 'undefined' && 
        typeof window.crearCuestionario.mostrarInfo === 'function') {
        window.crearCuestionario.mostrarInfo(mensaje);
    } else {
        console.warn('‚ö†Ô∏è ' + mensaje);
        // Fallback simple
        mostrarToastFallback(mensaje, 'warning');
    }
}

function mostrarConfirmacionElegante(titulo, mensaje, callback) {
    if (typeof window.crearCuestionario !== 'undefined' && 
        typeof window.crearCuestionario.mostrarConfirmacion === 'function') {
        window.crearCuestionario.mostrarConfirmacion(titulo, mensaje, callback);
    } else {
        // Fallback simple
        if (confirm(mensaje)) {
            callback();
        }
    }
}

function mostrarToastFallback(mensaje, tipo) {
    const colorMap = {
        'success': 'bg-success',
        'danger': 'bg-danger',
        'warning': 'bg-warning text-dark',
        'info': 'bg-info'
    };
    
    const iconMap = {
        'success': 'fas fa-check-circle',
        'danger': 'fas fa-exclamation-triangle',
        'warning': 'fas fa-exclamation-triangle',
        'info': 'fas fa-info-circle'
    };
    
    const toastHtml = `
        <div class="toast show position-fixed top-0 end-0 m-3" style="z-index: 9999;">
            <div class="toast-body ${colorMap[tipo]} text-white">
                <div class="d-flex align-items-center">
                    <i class="${iconMap[tipo]} me-2"></i>
                    ${mensaje}
                </div>
            </div>
        </div>
    `;
    
    const toastElement = document.createElement('div');
    toastElement.innerHTML = toastHtml;
    document.body.appendChild(toastElement);
    
    // Auto-remover despu√©s de 4 segundos
    setTimeout(() => {
        toastElement.remove();
    }, 4000);
}

// ===== ESTILOS ADICIONALES PARA MODALES =====

const estilosAdicionales = `
<style>
.preview-area {
    border: 2px dashed #dee2e6;
    border-radius: 8px;
    padding: 40px 20px;
    text-align: center;
    background: #f8f9fa;
    min-height: 200px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.preview-area.has-content {
    border-style: solid;
    border-color: #28a745;
    background: #f8fff9;
}

.preview-container {
    height: 100%;
}

.modal-content {
    border: none;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    border-radius: 12px;
}

.modal-header {
    border-radius: 12px 12px 0 0;
    padding: 20px 24px;
}

.modal-body {
    padding: 24px;
}

.modal-footer {
    padding: 16px 24px;
    border-top: 1px solid #e9ecef;
}

/* Estilos para toast fallback */
.toast {
    min-width: 300px;
    border: none;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.toast-body {
    padding: 16px 20px;
    font-weight: 500;
}

.spinner-border-sm {
    width: 1rem;
    height: 1rem;
}
</style>
`;

// Agregar estilos al documento
document.head.insertAdjacentHTML('beforeend', estilosAdicionales);

// ===== EVENT LISTENERS =====

document.addEventListener('DOMContentLoaded', function() {
    console.log('‚úÖ Sistema de recursos multimedia de plantilla inicializado');
    
    // Event listener para preview autom√°tico de YouTube en tiempo real
    document.addEventListener('input', function(e) {
        if (e.target.id === 'temp-url-youtube') {
            clearTimeout(e.target.debounceTimer);
            e.target.debounceTimer = setTimeout(() => {
                previsualizarYoutube();
            }, 500);
        }
    });
    
    // Limpiar URLs de objeto cuando se cierre el modal
    document.addEventListener('hidden.bs.modal', function(e) {
        if (e.target.id === 'modalTemporal') {
            // Limpiar URLs de objeto para liberar memoria
            const videos = e.target.querySelectorAll('video source');
            const audios = e.target.querySelectorAll('audio source');
            
            videos.forEach(source => {
                if (source.src.startsWith('blob:')) {
                    URL.revokeObjectURL(source.src);
                }
            });
            
            audios.forEach(source => {
                if (source.src.startsWith('blob:')) {
                    URL.revokeObjectURL(source.src);
                }
            });
        }
    });
    
    // Validaci√≥n de formularios en tiempo real
    document.addEventListener('change', function(e) {
        if (e.target.type === 'file') {
            const maxSizes = {
                'temp-archivo-imagen': 10 * 1024 * 1024,    // 10MB
                'temp-archivo-video': 50 * 1024 * 1024,     // 50MB
                'temp-archivo-documento': 25 * 1024 * 1024, // 25MB
                'temp-archivo-audio': 10 * 1024 * 1024      // 10MB
            };
            
            const maxSize = maxSizes[e.target.id];
            if (maxSize && e.target.files[0] && e.target.files[0].size > maxSize) {
                const maxMB = (maxSize / 1024 / 1024).toFixed(0);
                mostrarError(`El archivo es muy grande. M√°ximo ${maxMB}MB permitido.`);
                e.target.value = '';
                
                // Limpiar preview
                const preview = document.getElementById('preview-temp');
                if (preview) {
                    preview.className = 'preview-area';
                    preview.innerHTML = `
                        <i class="fas fa-exclamation-triangle fa-2x text-danger"></i>
                        <p class="text-danger mt-2">Archivo muy grande</p>
                    `;
                }
            }
        }
    });
    
    // Validaci√≥n de URLs de YouTube en tiempo real
    document.addEventListener('blur', function(e) {
        if (e.target.id === 'temp-url-youtube') {
            const url = e.target.value.trim();
            if (url && !extraerYouTubeId(url)) {
                mostrarAdvertencia('La URL de YouTube no parece ser v√°lida');
                e.target.classList.add('is-invalid');
            } else {
                e.target.classList.remove('is-invalid');
            }
        }
    });
    
    // Prevenir env√≠o accidental de formularios
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && e.target.matches('#modalTemporal input')) {
            e.preventDefault();
        }
    });
});

// ===== LOGGING Y DEBUG =====

console.log('üìã Plantilla pregunta adaptada - Sistema completo cargado');
console.log('üìé Funcionalidad de recursos: ‚úÖ');
console.log('üé® Interfaz profesional: ‚úÖ');
console.log('üì± Dise√±o responsive: ‚úÖ');
console.log('üîß Modales funcionales: ‚úÖ');
console.log('üöÄ Event listeners activos: ‚úÖ');

// ===== VARIABLES GLOBALES EXPUESTAS =====

// Exponer funciones principales para uso externo
window.plantillaPregunta = {
    mostrarModalSimple: mostrarModalSimple,
    duplicarPregunta: duplicarPregunta,
    eliminarRecurso: eliminarRecurso,
    obtenerPreguntaId: obtenerPreguntaId,
    preguntaActual: () => preguntaActual
};

</script>
